# PRD v2 - 회의실 관리 시스템 (상세)

본 문서는 현재 MVP를 기반으로 향후 유사 프로젝트 개발 시 오류를 최소화하기 위해 요구사항을 세분화해 정의합니다.

## 1. 목표/범위/비범위
- 목표: 회의실 예약/관리의 핵심 흐름을 안정적·명확하게 제공하고, 재사용 가능한 아키텍처로 고도화 기반을 마련한다.
- 범위:
  - 사용자: 날짜별 현황 조회, 예약 생성, 내 예약 조회/취소
  - 관리자: 회의실 CRUD, 관리자 로그인(ID/PW)
  - 실시간 반영: 예약/회의실 변경 즉시 UI 갱신
- 비범위(본 버전): 알림(이메일/문자), 외부 캘린더 연동, 다중 건물/조직 권한, SSO/OAuth, 다국어(i18n)

## 2. 페르소나/사용자 여정
- 일반 사용자(예약자): 회의실 가용 시간 확인 → 시간 선택 → 정보 입력 → 예약 완료 → 필요 시 조회/취소
- 관리자: 로그인 → 회의실 자원 관리(등록/수정/삭제) → 현황 모니터링

## 3. 사용자 스토리 + 수용 기준
- Story U1: 예약 현황 조회
  - Given 날짜 입력이 기본 오늘로 선택됨
  - When 다른 날짜로 변경
  - Then 해당 날짜의 각 회의실 예약 타임블록이 정렬되어 표시됨(오름차순)
- Story U2: 예약 생성
  - Given 사용 가능한 시간대 선택
  - When 이름/전화(010-0000-0000)/비밀번호(4자 이상) 유효 입력 후 제출
  - Then 중복 방지 규칙을 통과하면 예약이 생성되고 토스트로 성공 표시, 목록이 갱신됨
- Story U3: 내 예약 조회/취소
  - Given 전화번호/비밀번호 입력
  - When 조회 시 본인 예약만 목록으로 표시
  - Then 취소 클릭 시 비밀번호 검증 후 상태가 cancelled로 변경되고 실시간 반영됨
- Story A1: 관리자 회의실 생성/수정/삭제
  - Given 관리자 로그인 성공
  - When 이름/위치/수용인원 유효 입력 후 저장
  - Then DB에 반영되고 목록/실시간이 갱신됨

## 4. 기능 상세(필드/검증/오류)
- 회의실(Room)
  - 필수: name(1~100), location(1~200), capacity(양의 정수)
  - 제약: name 중복 불가, capacity>0
  - 오류 메시지: 필수 누락/형식 오류/중복 이름
- 예약(Reservation)
  - 필수: room_id, reservation_date(YYYY-MM-DD), start_time(HH:mm:ss), end_time(HH:mm:ss), reserver_name(1~50), reserver_phone(010-0000-0000), reserver_password(≥4)
  - 비즈 규칙: end>start, 동일 방·날짜 내 시간 겹침 금지(활성 예약 한정), 취소 시 상태만 변경
  - 오류 메시지: 형식 오류/중복 시간대/종료<시작/권한 없음
- 관리자 인증
  - 입력: username, password
  - 실패: 401 with 에러 메시지(아이디/비밀번호 오류)
  - 세션: `admin_session` 쿠키 발급(8h)

## 5. 화면/UX 상태 정의
- 메인: 날짜 입력, 회의실 카드 목록, 시간대 칩 UI, 예약 시트 폼(성공/실패 토스트)
- 내 예약: 전화/비밀번호 입력폼, 예약 목록(취소 버튼), 빈 상태 메시지
- 관리자: 로그인(아이디/비번), 회의실 폼/목록, 편집/삭제, 권한 없음 안내
- 로딩/오류: 스피너 또는 텍스트, 친화적 메시지(한국어)

## 6. API 계약(요약, 상세는 TRD 참고)
- 관리자 인증: POST /api/admin/auth { username, password } → 200 { ok } | 401 { error }
- 회의실 CRUD: GET/POST/PUT/DELETE /api/admin/rooms
- 예약: RPC `create_reservation`, `cancel_reservation`, `get_my_reservations` 사용

## 7. 데이터 일관성/규칙
- 중복 예약: DB 레벨 GIST EXCLUDE 제약으로 차단(활성 상태 한정)
- 시간 유효성: end_time > start_time
- 민감정보: 예약 비밀번호는 해시 저장(DB)·응답에서 제외

## 8. 비기능 요구
- 성능: 초기 로드 ≤ 2s, 실시간 반영 ≤ 1s 체감
- 안정성: 오류 메시지 명확, 폼 검증 클라/서버 이중화
- 접근성: 키보드 탭 이동 가능, 색 대비 준수
- 보안: HTTPS, 쿠키 HttpOnly/SameSite, 서버 비밀키 분리

## 9. 준비/완료 정의(DoR/DoD)
- DoR: 화면 와이어프레임, 필드/검증 표, API 스키마, 빈/에러 상태 문구 확정
- DoD: 단위/통합 테스트 통과, 핵심 플로우 수동 시나리오 체크, 문서/환경변수/릴리즈 체크리스트 완료

## 10. 테스트 계획(핵심 케이스)
- 예약 생성: 형식 오류, 겹침 시간대, 경계 시간(정각/마지막 슬롯)
- 내 예약 조회: 없는 계정/잘못된 비밀번호/정상 조회
- 관리자: 로그인 실패/성공, 회의실 중복 이름/음수 capacity/정상 CRUD
- 실시간: 예약/회의실 변경 시 목록 자동 갱신 여부

## 11. 롤아웃/운영
- 환경변수: ADMIN_USERNAME/PASSWORD, Supabase URL/Keys 사전 준비
- 마이그레이션 순서: 테이블→인덱스/제약→뷰→RPC→RLS
- 롤백: RPC/뷰/제약 단계별 역순 제거 스크립트 준비

## 12. 리스크/대응
- ENV 인증의 한계: vNext에서 관리자 계정 DB화+해시 인증 전환
- 실시간 노이즈: 채널 분리/필터링, 재시도 정책
- 시간대/현지화: 서버/클라 UTC 일관, UI 로컬 포맷

## 13. 재사용 원칙(1줄)
타입/스키마(Typescript/Zod)로 계약을 고정하고 서비스 계층 재사용으로 단일 책임을 유지하며, 핵심 경로 테스트를 필수화해 회귀를 방지한다.
